# æ„å›¾è¯†åˆ« + æ™ºèƒ½å›å¤å·¥ä½œæµ
# æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ prompt æ¨¡æ¿ã€æ„å›¾åˆ†æå’Œæ¡ä»¶è·¯ç”±
# ä½¿ç”¨æ–¹æ³•ï¼šjuglans examples/test.jgagent

name: "Intent-based Chat Workflow"
version: "0.1.0"
description: "æ„å›¾è¯†åˆ« + æ™ºèƒ½å›å¤å·¥ä½œæµ"
author: "Juglans Team"

# åŠ è½½æœ¬åœ°èµ„æºï¼ˆç›¸å¯¹äº workflow æ–‡ä»¶çš„è·¯å¾„ï¼‰
prompts: ["./test.jgprompt"]

# å®šä¹‰å…¥å£å’Œå‡ºå£èŠ‚ç‚¹
entry: [start]
exit: [reply]

# ========== èŠ‚ç‚¹å®šä¹‰ ==========

# 1. å¼€å§‹èŠ‚ç‚¹
[start]: notify(status="ğŸš€ å¼€å§‹å¤„ç†ç”¨æˆ·æ¶ˆæ¯...")

# 2. æ„å›¾è¯†åˆ« - ä½¿ç”¨ prompt æ¨¡æ¿ + agent åˆ†æ
[classify_intent]: chat(
  agent="test",
  message=p(
    slug="intent-classifier",
    user_message=$input.message
  ),
  format="json"
)

# 3. ä¿å­˜æ„å›¾åˆ°ä¸Šä¸‹æ–‡
[save_intent]: set(
  intent=$classify_intent.output.intent,
  confidence=$classify_intent.output.confidence
)

# 4. æ ¹æ®æ„å›¾åˆ†æ”¯å¤„ç†
[route]: notify(status="ğŸ”€ è·¯ç”±åˆ°: " + $ctx.intent)

# 5a. é—®å€™ç±»å›å¤
[handle_greeting]: chat(
  agent="test",
  message="ç”¨æˆ·è¯´ï¼š" + $input.message + "\nè¯·ç»™å‡ºå‹å¥½çš„é—®å€™å›å¤ã€‚"
)

# 5b. é—®é¢˜ç±»å›å¤
[handle_question]: chat(
  agent="test",
  message="ç”¨æˆ·æé—®ï¼š" + $input.message + "\nè¯·ç»™å‡ºè¯¦ç»†çš„è§£ç­”ã€‚"
)

# 5c. å‘½ä»¤ç±»å›å¤
[handle_command]: chat(
  agent="test",
  message="ç”¨æˆ·å‘½ä»¤ï¼š" + $input.message + "\nè¯·ç¡®è®¤å¹¶è¯´æ˜å¦‚ä½•æ‰§è¡Œã€‚"
)

# 5d. é—²èŠç±»å›å¤
[handle_chat]: chat(
  agent="test",
  message="ç”¨æˆ·è¯´ï¼š" + $input.message + "\nè¯·è‡ªç„¶åœ°èŠå¤©å›åº”ã€‚"
)

# 6. æœ€ç»ˆå›å¤
[reply]: notify(
  status="âœ… å®Œæˆ",
  message=$output
)

# ========== æµç¨‹å®šä¹‰ ==========

# ä¸»æµç¨‹
[start] -> [classify_intent] -> [save_intent] -> [route]

# æ¡ä»¶è·¯ç”±ï¼ˆæ ¹æ®æ„å›¾ç±»å‹ï¼‰
[route] if $ctx.intent == "greeting" -> [handle_greeting]
[route] if $ctx.intent == "question" -> [handle_question]
[route] if $ctx.intent == "command" -> [handle_command]
[route] if $ctx.intent == "chat" -> [handle_chat]

# é»˜è®¤è·¯ç”±ï¼ˆå…œåº•ï¼‰
[route] -> [handle_chat]

# æ‰€æœ‰åˆ†æ”¯æ±‡èšåˆ°æœ€ç»ˆå›å¤
[handle_greeting] -> [reply]
[handle_question] -> [reply]
[handle_command] -> [reply]
[handle_chat] -> [reply]
